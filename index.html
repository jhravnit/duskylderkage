<!doctype html>
<html lang="da">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Kage Awareness + Kage-Invaders</title>
  <meta name="color-scheme" content="light dark" />
  <meta name="theme-color" content="#0a84ff" />
  <style>
    /* ==== Apple-ish 2025 look ==== */
    :root{
      --bg: hsl(220 16% 9%);
      --fg: hsl(0 0% 100%);
      --muted: hsl(0 0% 100% / .72);
      --card: hsl(0 0% 100% / .08);
      --border: hsl(0 0% 100% / .14);
      --accent: #0a84ff; /* iOS bl√• */
      --accent-2: #64d2ff;
      --radius: 18px;
      --shadow: 0 12px 34px hsl(0 0% 0% / .35);
      --maxw: 1200px;
    }
    @media (prefers-color-scheme: light){
      :root{
        --bg: hsl(220 30% 98%);
        --fg: hsl(222 27% 12%);
        --muted: hsl(222 27% 12% / .70);
        --card: hsl(0 0% 100% /.65);
        --border: hsl(220 20% 85% /.8);
        --shadow: 0 12px 28px hsl(220 20% 30% / .18);
      }
    }
    *{ box-sizing: border-box }
    html,body{ height:100% }
    body{
      margin:0; color:var(--fg);
      font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "SF Pro Display","SF Pro Text","Segoe UI", Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      line-height:1.5;
      background:
        radial-gradient(1200px 600px at 10% -10%, hsl(212 100% 54% / .18), transparent 70%),
        radial-gradient(1000px 500px at 95% 0%, hsl(195 100% 70% / .18), transparent 60%),
        radial-gradient(800px 600px at 50% 110%, hsl(265 80% 70% / .14), transparent 60%),
        var(--bg);
      background-attachment: fixed;
    }
    .wrap{ max-width: var(--maxw); margin: 0 auto; padding: clamp(16px,2vw,32px); }
    header{
      display:flex; align-items:center; justify-content:space-between; gap:12px;
      padding: 14px;
      border-radius: calc(var(--radius) + 6px);
      backdrop-filter: saturate(140%) blur(10px);
      background: var(--card);
      border: 1px solid var(--border);
      box-shadow: var(--shadow);
    }
    .brand{ display:flex; align-items:center; gap:12px; font-weight:700; letter-spacing:.2px; }
    .badge{ font-size:12px; padding:4px 10px; border-radius:999px; border:1px solid var(--border); background: hsl(0 0% 100% / .08); }

    .grid{
      display:grid; gap: clamp(16px, 2.5vw, 24px);
      grid-template-columns: 1.05fr .95fr;
      margin-top: clamp(20px,3vw,28px);
    }
    @media (max-width: 980px){ .grid{ grid-template-columns: 1fr } }

    .card{
      border-radius: var(--radius);
      backdrop-filter: blur(12px) saturate(160%);
      background: var(--card);
      border: 1px solid var(--border);
      box-shadow: var(--shadow);
      overflow: clip;
      padding: clamp(18px, 3vw, 28px);
    }

    h1{ margin: 0 0 .4em; font-size: clamp(30px, 4vw, 48px); line-height:1.1; letter-spacing:-0.02em; }
    h2{ margin: 0 0 .6em; font-size: clamp(20px,2.2vw,26px) }
    .lede{ font-size: clamp(16px, 1.3vw, 19px); color: var(--muted); margin: 0 0 16px; }

    figure{ margin:0; border-radius: calc(var(--radius) - 2px); border: 1px solid var(--border); overflow:hidden; background: hsl(0 0% 100% /.04); }
    img{ display:block; width:100%; height:auto; object-fit: cover; transform: translateZ(0); }

    .btn-row{ display:flex; flex-wrap:wrap; gap:10px; margin-top: 14px }
    .btn{
      appearance:none; border:0; cursor:pointer; padding: 12px 16px; border-radius: 14px;
      font-weight: 600; background: linear-gradient(180deg, var(--accent), var(--accent-2));
      color: white; box-shadow: 0 8px 20px hsl(208 100% 45% / .35);
      transition: transform .15s ease, filter .2s ease;
    }
    .btn:active{ transform: translateY(1px) scale(.995) }

    /* Game */
    .game-wrap{ display:grid; gap:12px; grid-template-rows:auto 1fr auto; min-height: 420px; }
    .hud{ display:flex; align-items:center; justify-content:space-between; gap:10px; font-size:14px; color:var(--muted); }
    .canvas-frame{ position:relative; border-radius:14px; overflow:hidden; border:1px solid var(--border); background:hsl(0 0% 100% / .05); min-height:300px; }
    canvas{ display:block; width:100%; height:100% }
    .overlay{ position:absolute; inset:0; display:none; place-items:center; background:rgba(0,0,0,.55); color:#fff; padding:24px; text-align:center; font-size: clamp(18px, 2.6vw, 24px); }
    .overlay.show{ display:grid }

    /* Micro motion */
    .fade-in{ opacity:0; transform: translateY(8px); animation: in .55s ease forwards }
    @keyframes in{ to{ opacity:1; transform:none } }
    @media (prefers-reduced-motion: reduce){ .fade-in{ animation:none; opacity:1; transform:none } .btn{ transition:none } }

    /* Confetti canvas */
    #fx{ position: fixed; inset: 0; pointer-events: none; }
  </style>
</head>
<body>
  <canvas id="fx" aria-hidden="true"></canvas>

  <div class="wrap">
    <header class="fade-in" role="banner">
      <div class="brand" aria-label="Brand">
        <svg width="28" height="28" viewBox="0 0 24 24" fill="none" aria-hidden="true">
          <path d="M7 10V8a5 5 0 0 1 10 0v2" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/>
          <rect x="4" y="10" width="16" height="10" rx="2.6" stroke="currentColor" stroke-width="1.6"/>
          <circle cx="12" cy="15" r="1.8" fill="currentColor"/>
        </svg>
        <span>Awareness ‚Ä¢ IT-sikkerhed</span>
      </div>
      <span class="badge">Dette er en test</span>
    </header>

    <div class="grid">
      <!-- Venstre: budskab -->
      <main class="card fade-in" role="main">
        <h1>üîí T√¶nk f√∏r du klikker</h1>
        <p class="lede">Selv mails og beskeder fra kendte eller tillidsv√¶kkende afsendere kan v√¶re manipulerede. Klik aldrig p√• links eller √•bner vedh√¶ftede filer ukritisk ‚Äî stop op, tjek afsender, og vurder om det giver mening.</p>

        <h2>üëâ Heldigvis var dette kun en test ‚Ä¶ men du skylder nu kage üç∞</h2>
        <p class="lede">Tak fordi du spiller med ‚Äî pointen er at opdage trickene i tide. Kagen er bare en k√¶rlig p√•mindelse om, at vi alle kan blive snydt, hvis vi skynder os.</p>

        <figure>
          <img src="kage.png" alt="Kage" />
        </figure>
        <div class="btn-row">
          <button id="cakeBtn" class="btn">Tryk p√• mig for kage</button>
        </div>
      </main>

      <!-- H√∏jre: spil -->
      <aside class="card fade-in" aria-labelledby="game-title">
        <h2 id="game-title">üç∞ Kage-Invaders</h2>
        <div class="game-wrap">
          <div class="hud">
            <div>Styring: Bev√¶g musen ‚ñ∏ klik for at skyde</div>
            <div>
              <span>Score: <strong id="score">0</strong></span>
              <span style="margin-left:12px">Level: <strong id="level">1</strong></span>
              <span style="margin-left:12px">Liv: <strong id="lives">3</strong></span>
            </div>
          </div>
          <div class="canvas-frame">
            <canvas id="game" width="600" height="380"></canvas>
            <div id="overlay" class="overlay">
              <div>
                <div style="font-weight:700;margin-bottom:.4em">S√• der taber kage til alle üéÇ</div>
                <div>Klik for ny kage-omgang</div>
              </div>
            </div>
          </div>
          <div class="lede">Tip: Kagerne bliver gradvist hurtigere ‚Äî hold hovedet koldt üßä</div>
        </div>
      </aside>
    </div>
  </div>

  <script>
    /* ===== Confetti (genbruges af knap og spil) ===== */
    function confetti({duration=900, count=120}={}){
      if(matchMedia('(prefers-reduced-motion: reduce)').matches) return;
      const canvas = document.getElementById('fx');
      const ctx = canvas.getContext('2d');
      const dpr = Math.max(devicePixelRatio || 1, 1);

      function resize(){
        canvas.width = innerWidth * dpr;
        canvas.height = innerHeight * dpr;
        ctx.setTransform(dpr,0,0,dpr,0,0);
      }
      resize();

      const colors = ["#0a84ff","#64d2ff","#30d158","#ff9f0a","#bf5af2","#ff375f"];
      const rand = (min,max)=> Math.random()*(max-min)+min;
      const parts = Array.from({length: count}, () => ({
        x: rand(0, innerWidth),
        y: rand(-20, innerHeight * .15),
        vx: rand(-1.2, 1.2),
        vy: rand(1.8, 4.0),
        w: rand(6, 10),
        h: rand(8, 14),
        r: rand(0, 360),
        rv: rand(-8, 8),
        c: colors[(Math.random()*colors.length)|0]
      }));

      const start = performance.now();
      let raf;

      function tick(t){
        const dt = (t - (tick._last||t)) / 16.666; tick._last = t;
        ctx.clearRect(0,0,innerWidth,innerHeight);
        for(const p of parts){
          p.x += p.vx * dt;
          p.y += p.vy * dt;
          p.r += p.rv * dt;
          if(p.y > innerHeight + 20) { p.y = -10; p.x = Math.random()*innerWidth }
          ctx.save(); ctx.translate(p.x, p.y); ctx.rotate(p.r * Math.PI/180);
          ctx.fillStyle = p.c; ctx.fillRect(-p.w/2, -p.h/2, p.w, p.h); ctx.restore();
        }
        if(t - start < duration){ raf = requestAnimationFrame(tick) }
        else { ctx.clearRect(0,0,innerWidth,innerHeight); cancelAnimationFrame(raf) }
      }
      addEventListener('resize', resize, { once:true });
      raf = requestAnimationFrame(tick);
    }

    /* ===== Knap: √•bner mail + konfetti ===== */
    document.getElementById('cakeBtn').addEventListener('click', () => {
      confetti({ duration: 1200, count: 180 });
      const subject = "Awareness test: Jeg skylder kage";
      const body = "Hej,\n\nJeg klikkede p√• linket i awareness-testen og skylder kage. üç∞\n\nHilsen\n";
      const mailto = `mailto:jh@ravnit.dk?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
      // lille delay s√• konfettien kan ses et splitsekund
      setTimeout(()=>{ window.location.href = mailto; }, 500);
    });

    /* ===== Kage-Invaders (hurtigere) ===== */
    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');
    const overlay = document.getElementById('overlay');

    // Responsiv/retina tilpasning
    function fitCanvas(){
      const dpr = Math.max(1, window.devicePixelRatio || 1);
      const rect = canvas.getBoundingClientRect();
      canvas.width = Math.max(480, rect.width) * dpr;
      canvas.height = Math.max(320, rect.height) * dpr;
      ctx.setTransform(dpr,0,0,dpr,0,0);
    }
    const ro = new ResizeObserver(fitCanvas);
    ro.observe(canvas.parentElement);
    fitCanvas();

    const state = {
      running:false, gameOver:false,
      score:0, level:1, lives:3,
      lastShotAt:0, shootDelay:180, // lidt hurtigere skud
      mouseX: canvas.clientWidth/2,
      player:{x:280,y:0,w:58,h:12},
      bullets:[], enemies:[], enemyDir:1,
      enemySpeedBase:0.6, // hurtigere start
    };

    function placePlayer(){
      const H = canvas.clientHeight;
      state.player.y = H - 40;
      state.player.x = (canvas.clientWidth - state.player.w)/2;
    }
    function spawnWave(level=1){
      state.enemies.length = 0;
      const cols = Math.min(10, 6 + Math.floor(level * 0.8));
      const rows = Math.min(6, 3 + Math.floor(level * 0.5));
      const spacingX = 56, spacingY = 46;
      const offsetX = 32, offsetY = 28;
      for(let r=0; r<rows; r++){
        for(let c=0; c<cols; c++){
          state.enemies.push({x: offsetX + c*spacingX, y: offsetY + r*spacingY, w:34, h:28, hp:1, emoji:"üç∞"});
        }
      }
      state.enemyDir = 1;
    }
    function resetGame(){
      state.running=true; state.gameOver=false;
      state.score=0; state.level=1; state.lives=3;
      state.bullets.length=0; state.enemySpeedBase=0.6;
      placePlayer(); spawnWave(1);
      overlay.classList.remove('show');
      lastT = performance.now();
      requestAnimationFrame(loop);
    }

    placePlayer(); spawnWave(1);

    // Input
    canvas.addEventListener('mousemove', (e)=>{
      const r = canvas.getBoundingClientRect();
      state.mouseX = e.clientX - r.left;
    });
    canvas.addEventListener('click', ()=>{
      if(state.gameOver){ resetGame(); return; }
      shoot();
    });

    function shoot(){
      const now = performance.now();
      if(now - state.lastShotAt < state.shootDelay) return;
      state.lastShotAt = now;
      // konfetti ved skud (lille m√¶ngde for performance)
      confetti({ duration: 250, count: 24 });
      state.bullets.push({ x: state.player.x + state.player.w/2 - 2, y: state.player.y - 10, w:4, h:10, vy:-7.6 });
    }

    // HUD
    function updateHUD(){
      document.getElementById('score').textContent = state.score;
      document.getElementById('level').textContent = state.level;
      document.getElementById('lives').textContent = state.lives;
    }

    // Kollision
    function aabb(a,b){ return a.x < b.x + b.w && a.x + a.w > b.x && a.y < b.y + b.h && a.y + a.h > b.y; }

    // Tegn
    function drawPlayer(){
      const p = state.player;
      ctx.fillStyle = 'white';
      ctx.fillRect(p.x, p.y, p.w, p.h);
      ctx.fillRect(p.x + p.w*0.4, p.y - 10, p.w*0.2, 10);
    }
    function drawBullet(b){
      ctx.fillStyle = '#64d2ff';
      ctx.fillRect(b.x, b.y, b.w, b.h);
    }
    function drawEnemy(e){
      ctx.font = '24px system-ui, Apple Color Emoji, Segoe UI Emoji';
      ctx.textBaseline = 'top';
      ctx.fillText(e.emoji, e.x, e.y - 4);
    }

    let lastT = performance.now();
    function loop(t){
      if(!state.running) return;
      const dt = Math.min(33, t - lastT) / 16.666; // ~60fps normaliseret
      lastT = t;

      const W = canvas.clientWidth, H = canvas.clientHeight;

      // Player f√∏lger mus
      const targetX = Math.max(4, Math.min(W - state.player.w - 4, state.mouseX - state.player.w/2));
      state.player.x += (targetX - state.player.x) * 0.32;

      // Bullets
      for(const b of state.bullets){ b.y += b.vy * dt; }
      state.bullets = state.bullets.filter(b => b.y + b.h > 0);

      // Fjender
      const speed = (state.enemySpeedBase + (state.level-1)*0.15); // hurtigere progression
      let minX=Infinity, maxX=-Infinity;
      for(const e of state.enemies){ minX = Math.min(minX, e.x); maxX = Math.max(maxX, e.x + e.w); }
      if(maxX > W - 16) state.enemyDir = -1;
      if(minX < 16) state.enemyDir = 1;
      for(const e of state.enemies){ e.x += state.enemyDir * speed * dt * 12; }

      // Step ned lidt oftere
      if((t|0) % 1600 < 16){
        for(const e of state.enemies){ e.y += 6 + Math.min(12, state.level*1.1); }
      }

      // Kollisioner
      for(const b of state.bullets){
        for(const e of state.enemies){
          if(aabb(b,e)){
            e.hp = 0; b.y = -9999;
            state.score += 10;
            break;
          }
        }
      }
      state.enemies = state.enemies.filter(e => e.hp > 0);

      // Nederlag
      if(state.enemies.some(e => e.y + e.h >= state.player.y)){
        state.lives--;
        if(state.lives <= 0){
          state.running = false;
          state.gameOver = true;
          overlay.classList.add('show');
        }else{
          // ny b√∏lge samme level, let straf: ryk dem lidt op igen
          spawnWave(state.level);
        }
      }

      // N√¶ste level
      if(state.enemies.length === 0 && !state.gameOver){
        state.level += 1;
        state.enemySpeedBase += 0.12;
        spawnWave(state.level);
      }

      // Tegn
      ctx.clearRect(0,0,W,H);
      drawPlayer();
      for(const b of state.bullets) drawBullet(b);
      for(const e of state.enemies) drawEnemy(e);
      updateHUD();

      requestAnimationFrame(loop);
    }

    // Start f√∏rste runde n√•r musen bev√¶ger sig over spillet
    let armed = false;
    canvas.addEventListener('mouseenter', () => {
      if(!armed && !state.gameOver){
        armed = true; state.running = true; lastT = performance.now(); requestAnimationFrame(loop);
      }
    });

    // Init
    updateHUD();
  </script>
</body>
</html>
