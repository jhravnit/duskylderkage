<!doctype html>
<html lang="da">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>T√¶nk f√∏r du klikker ‚Äî Awareness test + Kagespil</title>
  <meta name="description" content="Kort awareness-budskab til IT-sikkerhed og et lille kage-space-invaders spil." />
  <meta name="color-scheme" content="light dark" />
  <meta name="theme-color" content="#0a84ff" />
  <style>
    :root{
      --bg: hsl(220 15% 8%);
      --fg: hsl(0 0% 100%);
      --muted: hsl(0 0% 100% / .68);
      --card: hsl(0 0% 100% / .08);
      --border: hsl(0 0% 100% / .14);
      --accent: #0a84ff;
      --accent-2: #64d2ff;
      --radius: 18px;
      --shadow: 0 10px 30px hsl(0 0% 0% / .35);
      --maxw: 1200px;
    }
    @media (prefers-color-scheme: light){
      :root{
        --bg: hsl(220 30% 98%);
        --fg: hsl(222 27% 12%);
        --muted: hsl(222 27% 12% / .70);
        --card: hsl(0 0% 100% /.65);
        --border: hsl(220 20% 85% /.8);
        --shadow: 0 12px 28px hsl(220 20% 30% / .18);
      }
    }
    *{ box-sizing: border-box }
    html,body{ height:100% }
    body{
      margin:0;
      font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "SF Pro Display","SF Pro Text","Segoe UI", Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      line-height:1.5;
      color: var(--fg);
      background:
        radial-gradient(1200px 600px at 10% -10%, hsl(212 100% 54% / .18), transparent 70%),
        radial-gradient(1000px 500px at 95% 0%, hsl(195 100% 70% / .18), transparent 60%),
        radial-gradient(800px 600px at 50% 110%, hsl(265 80% 70% / .14), transparent 60%),
        var(--bg);
      background-attachment: fixed;
    }
    .wrap{ max-width: var(--maxw); margin: 0 auto; padding: clamp(16px, 2vw, 32px); }
    header{
      display:flex; align-items:center; justify-content:space-between; gap:12px;
      padding: 14px;
      border-radius: calc(var(--radius) + 6px);
      backdrop-filter: saturate(140%) blur(10px);
      background: var(--card);
      border: 1px solid var(--border);
      box-shadow: var(--shadow);
    }
    .brand{ display:flex; align-items:center; gap:12px; font-weight:700; letter-spacing:.2px; }
    .badge{ font-size:12px; padding:4px 10px; border-radius:999px; border:1px solid var(--border); background: hsl(0 0% 100% / .08); }
    .grid{
      display:grid; gap: clamp(16px, 2.5vw, 24px);
      grid-template-columns: 1.05fr .95fr;
      margin-top: clamp(20px,3vw,28px);
    }
    @media (max-width: 980px){ .grid{ grid-template-columns: 1fr } }
    .card{
      border-radius: var(--radius);
      backdrop-filter: blur(12px) saturate(160%);
      background: var(--card);
      border: 1px solid var(--border);
      box-shadow: var(--shadow);
      overflow: clip;
      padding: clamp(18px, 3vw, 28px);
    }
    h1{ margin: 0 0 .4em; font-size: clamp(30px, 4vw, 48px); line-height:1.1; letter-spacing:-0.02em; }
    .lede{ font-size: clamp(16px, 1.3vw, 19px); color: var(--muted); margin: 0 0 16px; }
    .layout{
      display:grid; gap: clamp(16px, 2.5vw, 24px);
      grid-template-columns: 1.1fr .9fr;
    }
    @media (max-width: 900px){ .layout{ grid-template-columns: 1fr } }
    figure{ margin:0; border-radius: calc(var(--radius) - 2px); border: 1px solid var(--border); overflow:hidden; background: hsl(0 0% 100% /.04); }
    img{ display:block; width:100%; height:auto; object-fit: cover; transform: scale(1.002); }
    figcaption{ padding: 10px 14px; font-size: 14px; color: var(--muted); display:flex; align-items:center; justify-content:space-between; gap:8px; }
    .field{ display:grid; gap:6px; margin: 10px 0 2px; }
    .input{
      width:100%; padding: 12px 14px; border-radius: 12px;
      border:1px solid var(--border); background: hsl(0 0% 100% / .06);
      color: var(--fg); outline:none;
    }
    .hint{ font-size: 12px; color: var(--muted) }
    .btn-row{ display:flex; flex-wrap:wrap; gap:10px; margin-top: 14px }
    .btn{
      appearance:none; border:0; cursor:pointer; padding: 12px 16px; border-radius: 14px;
      font-weight: 600; background: linear-gradient(180deg, var(--accent), var(--accent-2));
      color: white; box-shadow: 0 8px 20px hsl(208 100% 45% / .35);
      transition: transform .15s ease, filter .2s ease;
    }
    .btn:active{ transform: translateY(1px) scale(.995) }
    .foot{ margin-top: 18px; font-size: 13px; color: var(--muted); }
    .fade-in{ opacity:0; transform: translateY(8px); animation: in .55s ease forwards }
    @keyframes in{ to{ opacity:1; transform:none } }
    @media (prefers-reduced-motion: reduce){ .fade-in{ animation:none; opacity:1; transform:none } .btn{ transition:none } }
    #fx{ position: fixed; inset: 0; pointer-events: none; }
    a{ color: var(--accent) }

    /* Game styles */
    .game-wrap{
      display:grid; gap:12px;
      grid-template-rows: auto 1fr auto;
      min-height: 420px;
    }
    .hud{
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      font-size: 14px; color: var(--muted);
    }
    .canvas-frame{
      position: relative; border-radius: 14px; overflow: hidden;
      border:1px solid var(--border); background: hsl(0 0% 100% / .05);
      min-height: 300px;
    }
    canvas{ display:block; width:100%; height:100%; }
    .game-cta{
      display:flex; gap:10px; flex-wrap:wrap; align-items:center;
    }
    .pill{
      padding:6px 10px; border-radius:999px; border:1px solid var(--border);
      background:hsl(0 0% 100% / .06); font-size:12px;
    }
  </style>
</head>
<body>
  <canvas id="fx" aria-hidden="true"></canvas>

  <!-- Header (beholdes som √∏nsket) -->
  <div class="wrap">
    <header class="fade-in" role="banner">
      <div class="brand" aria-label="Brand">
        <svg width="28" height="28" viewBox="0 0 24 24" fill="none" aria-hidden="true">
          <path d="M7 10V8a5 5 0 0 1 10 0v2" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/>
          <rect x="4" y="10" width="16" height="10" rx="2.6" stroke="currentColor" stroke-width="1.6"/>
          <circle cx="12" cy="15" r="1.8" fill="currentColor"/>
        </svg>
        <span>Awareness ‚Ä¢ IT-sikkerhed</span>
      </div>
      <span class="badge">Dette er en test</span>
    </header>

    <!-- To kolonner: venstre = din rubrik, h√∏jre = spil -->
    <div class="grid">
      <!-- Venstre: samlet rubrik (som tidligere) -->
      <main class="card fade-in" role="main" aria-labelledby="h-title">
        <h1 id="h-title">üîí T√¶nk f√∏r du klikker</h1>
        <p class="lede">
          Selv mails og beskeder fra kendte eller tillidsv√¶kkende afsendere kan v√¶re manipulerede.
          Klik aldrig p√• links eller √•bn filer ukritisk ‚Äî stop altid op og overvej, om det giver mening.
        </p>

        <div class="layout">
          <!-- Tekst + navn + knap -->
          <section>
            <h2 style="margin:0 0 .6em; font-size:clamp(20px,2.2vw,26px)">üëâ Heldigvis var dette kun en test ‚Ä¶ men du skylder nu kage üç∞</h2>

            <form id="ackForm" onsubmit="return false;">
              <div class="field">
                <label for="userName">Dit navn</label>
                <input id="userName" class="input" name="userName" type="text" inputmode="text" autocomplete="name"
                      placeholder="Skriv dit navn ‚Ä¶ (bruges i mailen)" />
                <div class="hint" id="toHint">Modtager: <span id="toDisplay"></span> (kan s√¶ttes med <code>?to=mail@dom√¶ne.dk</code>)</div>
              </div>

              <div class="btn-row">
                <button class="btn" id="cakeBtn" aria-label="Bekr√¶ft og send mail">Jeg tager kage med</button>
              </div>
            </form>

            <p class="foot">PS: Vores m√•l er ikke at fange dig ‚Äî men at hj√¶lpe dig med at opdage fors√∏gene i tide.</p>
          </section>

          <!-- Billede -->
          <section>
            <figure>
              <img id="cake" alt="En l√¶kker lagkage, bl√∏d glasur og smulder p√• toppen" />
              <figcaption>
                <span>Bevismateriale</span>
                <a id="cakeLink" target="_blank" rel="noopener">√Öbn billedet</a>
              </figcaption>
            </figure>
          </section>
        </div>
      </main>

      <!-- H√∏jre: Space-Invaders-agtigt kagespil -->
      <aside class="card fade-in" aria-labelledby="game-title">
        <h2 id="game-title" style="margin:0 0 .6em; font-size:clamp(20px,2.2vw,26px)">üç∞ Kage-Invaders</h2>
        <div class="game-wrap">
          <div class="hud">
            <div class="game-cta">
              <button class="btn" id="startBtn">Start / Pause</button>
              <span class="pill">Styring: bev√¶g musen ‚ñ∏ klik for at skyde</span>
            </div>
            <div>
              <span>Score: <strong id="score">0</strong></span>
              <span style="margin-left:12px">Level: <strong id="level">1</strong></span>
              <span style="margin-left:12px">Liv: <strong id="lives">3</strong></span>
            </div>
          </div>
          <div class="canvas-frame">
            <canvas id="game" width="600" height="380" aria-label="Kagespil canvas"></canvas>
          </div>
          <div class="hint">Tip: Ram s√• mange üç∞ som muligt. Kagerne bev√¶ger sig hurtigere for hvert level!</div>
        </div>
      </aside>
    </div>
  </div>

  <script>
    /* ===== Shared visuals (toast + confetti) ===== */
    function toast(msg){
      const el = document.createElement('div');
      el.textContent = msg;
      Object.assign(el.style,{
        position:'fixed', left:'50%', bottom:'24px', transform:'translateX(-50%)',
        background:'rgba(0,0,0,.78)', color:'#fff', padding:'10px 14px',
        borderRadius:'12px', fontSize:'14px', zIndex:9999, boxShadow:'0 10px 30px rgba(0,0,0,.35)'
      });
      if(matchMedia('(prefers-color-scheme: light)').matches){
        el.style.background = 'rgba(20,20,20,.88)';
      }
      document.body.appendChild(el);
      setTimeout(()=> el.style.opacity = '0', 1400);
      setTimeout(()=> el.remove(), 1800);
    }

    function confetti({duration=1200, count=150}={}){
      if(matchMedia('(prefers-reduced-motion: reduce)').matches) return;
      const canvas = document.getElementById('fx');
      const ctx = canvas.getContext('2d');
      const dpr = Math.max(devicePixelRatio || 1, 1);
      const resize = () => {
        canvas.width = innerWidth * dpr;
        canvas.height = innerHeight * dpr;
        ctx.scale(dpr, dpr);
      };
      resize();
      const colors = ["#0a84ff","#64d2ff","#30d158","#ff9f0a","#bf5af2","#ff375f"];
      const rand = (min,max)=> Math.random()*(max-min)+min;
      const parts = Array.from({length: count}, () => ({
        x: rand(0, innerWidth), y: rand(-20, innerHeight * .2),
        vx: rand(-1.2, 1.2), vy: rand(1.5, 3.8),
        w: rand(6, 10), h: rand(8, 14),
        r: rand(0, 360), rv: rand(-8, 8),
        c: colors[(Math.random()*colors.length)|0]
      }));
      const start = performance.now();
      let raf;
      const tick = (t)=>{
        const dt = (t - (tick._last||t)) / 16.666;
        tick._last = t;
        ctx.clearRect(0,0,innerWidth,innerHeight);
        for(const p of parts){
          p.x += p.vx * dt; p.y += p.vy * dt; p.r += p.rv * dt;
          if(p.y > innerHeight + 20) { p.y = -10; p.x = Math.random()*innerWidth }
          ctx.save(); ctx.translate(p.x, p.y); ctx.rotate(p.r * Math.PI/180);
          ctx.fillStyle = p.c; ctx.fillRect(-p.w/2, -p.h/2, p.w, p.h); ctx.restore();
        }
        if(t - start < duration){ raf = requestAnimationFrame(tick) }
        else { ctx.clearRect(0,0,innerWidth,innerHeight); cancelAnimationFrame(raf) }
      };
      addEventListener('resize', resize, { once:true });
      raf = requestAnimationFrame(tick);
    }

    /* ===== Awareness-rubrik (navn + mail) ===== */
    const CAKE_IMG_URL_DEFAULT = "kage.png";
    const RECIPIENT_DEFAULT = "jh@ravnit.dk";
    const qs = new URLSearchParams(location.search);
    const RECIPIENT_EMAIL = (qs.get("to") || RECIPIENT_DEFAULT).trim();

    const cakeImg = document.getElementById('cake');
    const cakeLink = document.getElementById('cakeLink');
    cakeImg.src = CAKE_IMG_URL_DEFAULT;
    cakeLink.href = CAKE_IMG_URL_DEFAULT;

    document.getElementById('toDisplay').textContent = RECIPIENT_EMAIL;

    document.getElementById('ackForm').addEventListener('submit', (e) => {
      e.preventDefault();
      document.getElementById('cakeBtn').click();
    });

    document.getElementById('cakeBtn').addEventListener('click', () => {
      const name = (document.getElementById('userName').value || "").trim();
      confetti({ duration: 1400, count: 180 });
      toast("Respekt! Kage er p√• vej üéâ");

      const subject = `Awareness test: ${name ? name + " " : ""}skylder kage`;
      const body =
`Hej,

Jeg klikkede p√• linket i awareness-testen og anerkender hermed, at jeg skylder kage. üç∞

Navn: ${name || "(ikke udfyldt)"}
Tidspunkt: ${new Date().toLocaleString()}
Enhed: ${navigator.platform}
Browser: ${navigator.userAgent}

Hilsen
${name || "(skriv dit navn her)"}`;

      const mailto = `mailto:${encodeURIComponent(RECIPIENT_EMAIL)}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
      setTimeout(() => {
        const w = window.open(mailto);
        if(!w){ window.location.href = mailto; }
      }, 600);
    });

    /* ===== Kage-Invaders spil (mus + klik) ===== */
    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');

    // Responsive canvas (retina)
    function fitCanvas(){
      const dpr = Math.max(1, window.devicePixelRatio || 1);
      // Behold aspect fra attrib width/height men tilpas CSS-st√∏rrelse
      const rect = canvas.getBoundingClientRect();
      canvas.width = Math.max(400, rect.width) * dpr;
      canvas.height = Math.max(280, rect.height) * dpr;
      ctx.setTransform(dpr,0,0,dpr,0,0); // skaler tegning til CSS pixels
    }
    const ro = new ResizeObserver(fitCanvas);
    ro.observe(canvas.parentElement);
    fitCanvas();

    // Spiltilstand
    const state = {
      running: false,
      score: 0,
      level: 1,
      lives: 3,
      lastShotAt: 0,
      shootDelay: 220, // ms
      mouseX: 0,
      player: { x: 200, y: 0, w: 64, h: 14 },
      bullets: [],
      enemies: [],
      enemyDir: 1, // 1 -> h√∏jre, -1 -> venstre
      enemySpeedBase: 0.6,
      waveClearedAt: 0
    };

    // Initial placering af player (nederst)
    function placePlayer(){
      const H = canvas.clientHeight;
      state.player.y = H - 36;
      state.player.x = (canvas.clientWidth - state.player.w) / 2;
    }
    placePlayer();

    // Lav en b√∏lge kage-fjender
    function spawnWave(level=1){
      state.enemies.length = 0;
      const cols = Math.min(10, 6 + Math.floor(level * 0.8));
      const rows = Math.min(6, 3 + Math.floor(level * 0.5));
      const spacingX = 56, spacingY = 46;
      const offsetX = 32, offsetY = 28;
      for(let r=0; r<rows; r++){
        for(let c=0; c<cols; c++){
          state.enemies.push({
            x: offsetX + c*spacingX,
            y: offsetY + r*spacingY,
            w: 34,
            h: 28,
            hp: 1,
            emoji: "üç∞",
          });
        }
      }
      state.enemyDir = 1;
    }
    spawnWave(1);

    // Input (mus)
    canvas.addEventListener('mousemove', (e) => {
      const rect = canvas.getBoundingClientRect();
      state.mouseX = e.clientX - rect.left;
    });
    canvas.addEventListener('click', shoot);
    // Skyde-funktion
    function shoot(){
      const now = performance.now();
      if(now - state.lastShotAt < state.shootDelay) return;
      state.lastShotAt = now;
      // Kuglens udgangspunkt midt over player
      state.bullets.push({ x: state.player.x + state.player.w/2 - 2, y: state.player.y - 8, w: 4, h: 10, vy: -7.2 });
    }

    // Start/Pause
    const startBtn = document.getElementById('startBtn');
    startBtn.addEventListener('click', () => {
      state.running = !state.running;
      if(state.running){
        lastT = performance.now();
        loop(lastT);
      }
    });

    // Tegne-hj√¶lpere
    function drawPlayer(){
      const p = state.player;
      ctx.fillStyle = 'white';
      // Lille "skib"/bar
      ctx.fillRect(p.x, p.y, p.w, p.h);
      ctx.fillRect(p.x + p.w*0.4, p.y - 10, p.w*0.2, 10); // t√•rn
    }
    function drawBullet(b){
      ctx.fillStyle = '#64d2ff';
      ctx.fillRect(b.x, b.y, b.w, b.h);
    }
    function drawEnemy(e){
      // Emoji som kage
      ctx.font = '24px system-ui, Apple Color Emoji, Segoe UI Emoji';
      ctx.textBaseline = 'top';
      ctx.fillText(e.emoji, e.x, e.y - 4);
      // Diskret hitbox (debug off)
      // ctx.strokeStyle='rgba(255,255,255,.15)'; ctx.strokeRect(e.x, e.y, e.w, e.h);
    }
    function drawHUD(){
      document.getElementById('score').textContent = state.score;
      document.getElementById('level').textContent = state.level;
      document.getElementById('lives').textContent = state.lives;
    }

    // Kollisionscheck (Axis-Aligned Bounding Box)
    function aabb(a,b){
      return a.x < b.x + b.w && a.x + a.w > b.x && a.y < b.y + b.h && a.y + a.h > b.y;
    }

    // Game loop
    let lastT = performance.now();
    function loop(t){
      if(!state.running) return;
      const dt = Math.min(33, t - lastT) / 16.666; // ~60fps normaliseret
      lastT = t;

      const W = canvas.clientWidth, H = canvas.clientHeight;

      // Opdater player mod musens X
      const targetX = Math.max(4, Math.min(W - state.player.w - 4, state.mouseX - state.player.w/2));
      state.player.x += (targetX - state.player.x) * 0.3;

      // Opdater bullets
      for(const b of state.bullets){ b.y += b.vy * dt; }
      state.bullets = state.bullets.filter(b => b.y + b.h > 0);

      // Opdater fjender (vandret bev√¶gelse + step ned ved kant)
      const speed = (state.enemySpeedBase + (state.level-1)*0.15) * 1.2;
      let minX=Infinity, maxX=-Infinity;
      for(const e of state.enemies){ minX = Math.min(minX, e.x); maxX = Math.max(maxX, e.x + e.w); }
      if(maxX > W - 16) state.enemyDir = -1;
      if(minX < 16) state.enemyDir = 1;
      for(const e of state.enemies){ e.x += state.enemyDir * speed * dt * 10; }

      // Af og til step ned
      if((t|0) % 1500 < 16){
        for(const e of state.enemies){ e.y += 6 + Math.min(10, state.level*1.2); }
      }

      // Kollision: kugler vs fjender
      for(const b of state.bullets){
        for(const e of state.enemies){
          if(aabb(b, e)){
            e.hp -= 1;
            b.y = -9999; // fjern kugle
            state.score += 10;
            confetti({ duration: 300, count: 20 });
            break;
          }
        }
      }
      state.enemies = state.enemies.filter(e => e.hp > 0);

      // Tjek nederlag (fjende r√∏rer bunden)
      if(state.enemies.some(e => e.y + e.h >= state.player.y)){
        state.lives -= 1;
        toast("Av! En kage slap igennem üí•");
        // Reset b√∏lge
        spawnWave(state.level);
        if(state.lives <= 0){
          state.running = false;
          toast("Game over ‚Äî pr√∏v igen!");
        }
      }

      // N√¶ste level hvis ryddet
      if(state.enemies.length === 0){
        state.level += 1;
        state.enemySpeedBase += 0.2;
        spawnWave(state.level);
        toast(`Level ${state.level} üç∞`);
      }

      // Ryd canvas og tegn
      ctx.clearRect(0,0,W,H);
      drawPlayer();
      for(const b of state.bullets) drawBullet(b);
      for(const e of state.enemies) drawEnemy(e);
      drawHUD();

      // Autoskyd, hvis mus holdes nede (valgfri): vi holder det ved klik for simpelt.
      requestAnimationFrame(loop);
    }

    // Start spillet automatisk, n√•r brugeren f√∏rste gang bev√¶ger musen henover canvas
    let armed = false;
    canvas.addEventListener('mouseenter', () => {
      if(!armed){ armed = true; state.running = true; lastT = performance.now(); loop(lastT); }
    });

    // Tastatur fallback (venstre/h√∏jre + mellemrum skyder)
    window.addEventListener('keydown', (e) => {
      if(e.code === 'Space'){ shoot(); }
      if(e.code === 'KeyP'){ state.running = !state.running; if(state.running){ lastT = performance.now(); loop(lastT); } }
    });
  </script>
</body>
</html>
